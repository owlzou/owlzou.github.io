<!DOCTYPE html>
<html lang="en">
  <head>
    
    <link href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;tocbot.css" rel="stylesheet"/>
     
      <meta charset="UTF-8"/>
      <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
      <link href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;style.css" rel="stylesheet"/>
      <link href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;favicon.ico" rel="shortcut icon" type="image/x-icon"/>
      <link href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;favicon.ico" rel="icon" type="image/x-icon"/>
      <title>
        
    Endlesså¼€å‘ç¬”è®°ï¼ˆ2ï¼‰ï¼šä½¿ç”¨LiteDB | Catalyst

      </title>
    

  </head>
  <body>
    <div class="background"></div>
    <div class="fab">
  <i data-feather="chevron-up"></i>
</div>

    
      <div class="grass"></div>
    
    <button class="burger">
      <i data-feather="menu"></i>
    </button>
    <div class="wrapper">
      <div
        class="container">
        <!-- sidebar -->
        
          <div class="mask"></div>
          <div class="sidebar">
            <div class="title">Catalyst</div>
            <div class="divider"></div>
            <nav>
              <ul>
                
                  <li>
                    <a href="&#x2F;">é¦–é¡µ</a>
                  </li>
                
                  <li>
                    <a href="&#x2F;archives">å½’æ¡£</a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects">é¡¹ç›®</a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about">å…³äº</a>
                  </li>
                
              </ul>
              <div class="side-buttons">
                
                  
                    
                      <a class="side-button" href="&#x2F;search">
                        <i data-feather="search"></i>
                      </a>
                    
                  
                    
                      <a class="side-button" href="&#x2F;tags">
                        <i data-feather="tag"></i>
                      </a>
                    
                  
                    
                      <a class="side-button" href="&#x2F;categories">
                        <i data-feather="feather"></i>
                      </a>
                    
                  
                    
                      <a class="side-button" href="https:&#x2F;&#x2F;github.com&#x2F;owlzou" target="_blank">
                        <i data-feather="github"></i>
                      </a>
                    
                  
                
              </div>
            </nav>
            
    <div class="toc-wrapper">
        <div class="toc"></div>
    </div>

            
              <svg class="bigcat" viewbox="0 0 92.685 127.487" xmlns="http://www.w3.org/2000/svg">
                <path d="M50.87 0l6.682 15.234-2.405 1.87c-12.421-3.946-11.914-4.366-17.373-6.413 3.134 22.379 7.721 39.56 17.908 40.892-4.452 9.927-9.597 25.157-12.4 38.035a128.59 128.59 0
                  00-2.016-5.921c-3.92-10.581-10.056-20.87-22.207-26.16a11.983 11.983 0 00-5.147-1.005c-5.124.144-9.936 3.547-12.203 8.532-3.023 6.645-2.272 15.953 4.162 25.388 3.005 4.407 9.615-.1
                  6.61-4.507-5.239-7.682-5.133-13.955-3.489-17.569 1.644-3.614 6.484-4.988 9.279-3.77 9.64 4.197 11.906 10.583 15.493 20.266 2.827 7.631 4.722 17.886 7.65 26.067.967 9.304 5.264
                  15.882 15.069 16.548H74.39c29.742-7.229 15.084-36.557 6.682-78.31C113.317 24.689 61.539 4.242 50.87 0z"></path>
              </svg>
            
          </div>
        
        <!-- main -->
        <div class="main"> 
    <div class="post blog">
        <h1 class="post-title">
            Endlesså¼€å‘ç¬”è®°ï¼ˆ2ï¼‰ï¼šä½¿ç”¨LiteDB</h1>
        <div class="post-info">
            <i data-feather="clock"></i>
            <div class="post-date">2020-07-13</div>
            
                
                    
                    <a class="post-category" href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;categories&#x2F;android&#x2F;">Android</a>
                
            
            
                <i data-feather="tag"></i>
                
                    
                    <a class="post-tag" href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;tags&#x2F;fabulous&#x2F;">Fabulous</a>
                
                    
                    <a class="post-tag" href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;tags&#x2F;f&#x2F;">F#</a>
                
            
        </div>
        
        <article class="post-type">
            <p>èƒ½ç”¨å°±è¡Œ ğŸ‘¿</p>
<p>è¿™ç¯‡ä¸»è¦æ˜¯æ•°æ®ä¿å­˜ï¼Œä½¿ç”¨<a href="https://github.com/mbdavid/LiteDB">LiteDB</a>ã€‚</p>
<span id="continue-reading"></span><h2 id="an-zhuang">å®‰è£…</h2>
<ol>
<li>åœ¨å·¥ç¨‹å‘½ä»¤è¡Œä¸‹ï¼š<code>Install-Package LiteDB</code>ï¼ˆæ²¡æˆåŠŸï¼‰æˆ–<code>dotnet add &lt;é¡¹ç›®åç§°&gt; package LiteDB --version 4.1.4</code>ï¼ˆç›®å‰<code>LiteDB.FSharp</code>ä¸æ”¯æŒ 5.0+çš„<code>LiteDB</code>ï¼‰æˆ–è€…ä¸‹è½½å¤åˆ¶ <code>dll</code>æ–‡ä»¶ã€‚</li>
<li>å®‰è£…<a href="https://github.com/Zaid-Ajaj/LiteDB.FSharp">LiteDB.FSharp</a>:<code>dotnet add &lt;é¡¹ç›®åç§°&gt; package LiteDB.FSharp --version 2.15.1</code>ã€‚</li>
</ol>
<p>æ³¨ï¼š</p>
<p>ç”Ÿæˆæ—¶å‡ºç°äº†é”™è¯¯</p>
<blockquote>
<p>é”™è¯¯ XA2002: æ— æ³•è§£æå¼•ç”¨: <code>LiteDB</code>ï¼Œå¼•ç”¨è€…ä¸º <code>Endless</code>ã€‚è¯·ä¸º <code>LiteDB</code> æ·»åŠ  NuGet åŒ…æˆ–ç¨‹åºé›†å¼•ç”¨ï¼Œæˆ–åˆ é™¤å¯¹ <code>Endless</code> çš„å¼•ç”¨ã€‚</p>
</blockquote>
<p>å¯èƒ½æ˜¯å› ä¸ºæˆ‘ç”¨å®˜æ–¹ç»™çš„å®‰è£…æ–¹æ³•å¤±è´¥äº†ï¼Œæ‰€ä»¥åŒ…æ²¡è£…å®Œå…¨ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼šæ‰“å¼€<code>NugetåŒ…ç®¡ç†å™¨</code>ç»™ Android åŒ…é‡è£…ä¸€éåº“ã€‚</p>
<h2 id="bao-cun-lu-jing">ä¿å­˜è·¯å¾„</h2>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶æ¥å†™æ•°æ®åº“ç›¸å…³ã€‚</p>
<p>æ–‡ä»¶ä¿å­˜åœ¨ android çš„<a href="https://developer.android.google.cn/training/data-storage/app-specific">åº”ç”¨ä¸“å±æ–‡ä»¶ç›®å½•</a>ä¸­ã€‚åˆ©ç”¨<a href="https://docs.microsoft.com/zh-cn/xamarin/xamarin-forms/app-fundamentals/dependency-service/">dependency-service</a>å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ç„¶ååˆ†å¹³å°å®ç°ã€‚(å‚ç…§äº†è¿™ä¸ªå®ç°åå¸çš„æ–¹æ³•ï¼š<a href="https://stackoverflow.com/questions/35279403/toast-equivalent-for-xamarin-forms">Toast equivalent for Xamarin Forms</a>)</p>
<p>å®šä¹‰ï¼š</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">type IDataBasePath =
    abstract member Path:unit-&gt;string
</span></code></pre>
<p>åœ¨ Android æ–‡ä»¶å¤¹ä¸‹ï¼š</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">type DataBasePath()=
    interface ELType.IDataBasePath with
        member this.Path() = System.IO.Path.Combine(System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal), &quot;mydata.db&quot;)

[&lt;assembly: Xamarin.Forms.Dependency(typeof&lt;DataBasePath&gt;)&gt;]
do()
</span></code></pre>
<p>æœ€åä½¿ç”¨çš„æ—¶å€™</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#72ab00;">open </span><span style="color:#c23f31;">LiteDB
</span><span style="color:#72ab00;">open </span><span style="color:#c23f31;">LiteDB.FSharp
</span><span style="color:#72ab00;">open </span><span style="color:#c23f31;">Xamarin.Forms

</span><span style="color:#72ab00;">let </span><span style="color:#5597d6;">mapper </span><span style="color:#72ab00;">=</span><span style="color:#1f1f1f;"> FSharpBsonMapper</span><span style="color:#b3933a;">()
</span><span style="color:#72ab00;">let </span><span style="color:#5597d6;">path </span><span style="color:#72ab00;">=</span><span style="color:#1f1f1f;"> DependencyService.Get</span><span style="color:#72ab00;">&lt;</span><span style="color:#1f1f1f;">IDataBasePath</span><span style="color:#72ab00;">&gt;</span><span style="color:#b3933a;">()</span><span style="color:#1f1f1f;">.Path</span><span style="color:#b3933a;">()
</span><span style="color:#72ab00;">let </span><span style="color:#5597d6;">db </span><span style="color:#72ab00;">= new</span><span style="color:#1f1f1f;"> LiteDatabase</span><span style="color:#72ab00;">(</span><span style="color:#1f1f1f;">path</span><span style="color:#72ab00;">,</span><span style="color:#1f1f1f;"> mapper</span><span style="color:#72ab00;">)
</span></code></pre><h2 id="wen-dang-jie-gou">æ–‡æ¡£ç»“æ„</h2>
<p><code>LiteDB.FSharp</code>åº“ä½¿ç”¨ records ç»„ç»‡ç»“æ„ã€‚è¿™é‡Œç›´æ¥ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„<code>ELEntry</code>ä½œä¸ºå­˜å‚¨æ•°æ®ï¼š</p>
<p>åˆ©ç”¨ ID è‡ªå¢ã€‚</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#b39f04;">[&lt;CLIMutable&gt;]
</span><span style="color:#72ab00;">type </span><span style="color:#c23f31;">ELEntry</span><span style="color:#72ab00;">= {</span><span style="color:#1f1f1f;">
    Id</span><span style="color:#72ab00;">:</span><span style="color:#c23f31;">int</span><span style="color:#1f1f1f;">
    Content</span><span style="color:#72ab00;">:</span><span style="color:#c23f31;">string</span><span style="color:#1f1f1f;">
    Date</span><span style="color:#72ab00;">:</span><span style="color:#c23f31;">string
</span><span style="color:#72ab00;">}
</span></code></pre>
<p>ä¹‹åæ·»åŠ çš„æ¡ç›®,éœ€è¦è‡ªå¢çš„ id å¡« 0ã€‚</p>
<h3 id="shu-ju-jie-gou">æ•°æ®ç»“æ„</h3>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">type ELEntry= {
    Id:int
    Content:string
    Date:System.DateTime
}

type Model = {
    NowId:int
    NowWrite:string
    Data:seq&lt;ELEntry&gt;
}
</span></code></pre>
<p>æ¶ˆæ¯æœ‰æ–°å»ºã€æ‰“å¼€ã€åˆ é™¤æ¶ˆæ¯æ¡†ã€åˆ é™¤ã€åé¦ˆè¾“å…¥çš„æ–‡å­—ã€ä¿å­˜å’Œåˆ‡æ¢ Tab ã€‚</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">type Msg =
    | NewEntry
    | Open of int
    | Delete of bool*int
    | DeleteAlert of int
    | NowWriting of string
    | Save
    | Switch of int
</span></code></pre><h2 id="zeng-shan-gai-cha">å¢åˆ æ”¹æŸ¥</h2>
<p>å…ˆå¾—åˆ°ä¸€ä¸ªè¡¨ã€‚</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#72ab00;">let </span><span style="color:#5597d6;">data </span><span style="color:#72ab00;">=</span><span style="color:#1f1f1f;"> db.GetCollection</span><span style="color:#72ab00;">&lt;</span><span style="color:#1f1f1f;">ELEntry</span><span style="color:#72ab00;">&gt;(</span><span style="color:#d07711;">&quot;entries&quot;</span><span style="color:#72ab00;">)
</span></code></pre>
<ol>
<li>å¢åŠ ï¼š<code>data.Insert(newEntry)</code></li>
<li>ä¿®æ”¹ï¼š<code>data.Upsert(newEntry)</code>ï¼ˆæ–°å¢æˆ–æ’å…¥ï¼‰ï¼Œ<code>data.Update(newEntry)</code>ã€‚</li>
<li>æŸ¥æ‰¾ï¼šè¿”å›çš„æ•°æ®ç±»å‹æ˜¯<code>seq&lt;ç±»å‹&gt;</code>ã€‚æ‰€ä»¥ Model ä¸­çš„ Data ä¸º<code>seq&lt;ELEntry&gt;</code>å‹ã€‚
<ul>
<li>æŸ¥æ‰¾å…¨éƒ¨ï¼š <code>data.FindAll()</code></li>
<li>æŒ‰ id æŸ¥æ‰¾: <code>data.FindOne(fun data-&gt;data.Id=id)</code></li>
</ul>
</li>
<li>åˆ é™¤ï¼š
<ul>
<li>æŒ‰ id åˆ é™¤ï¼š<code>data.Delete id</code></li>
</ul>
</li>
</ol>
<h3 id="li">ä¾‹</h3>
<ol>
<li>
<p>è¾“å…¥çš„æ—¶å€™ï¼Œæ•°æ®ä¿å­˜åˆ°<code>model.NowWrite</code>ä¸­ã€‚</p>
<p>å¯¹åº”<code>type Msg</code>çš„æ¶ˆæ¯ç±»å‹<code>NowWriting</code>ã€‚åœ¨è§†å›¾çš„ Editor ä¸­ï¼Œæ¯å½“è¾“å…¥æ–‡å­—æ—¶å‘é€æ¶ˆæ¯ã€‚</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">View.Editor
</span><span style="color:#1f1f1f;">    (text = model.NowWrite,
</span><span style="color:#1f1f1f;">    textChanged = (fun text -&gt; dispatch (NowWriting text.NewTextValue) |&gt; ignore),
</span><span style="color:#1f1f1f;">    &lt;ç•¥&gt;)
</span></code></pre>
<p>å¤„ç†æ–¹æ³•ï¼š</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">match msg with
</span><span style="color:#1f1f1f;">| NowWriting str -&gt; { model with ELType.NowWrite = str }, Cmd.none
</span><span style="color:#1f1f1f;">| &lt;ç•¥&gt;
</span></code></pre></li>
<li>
<p>ä¿å­˜çš„æ—¶å€™ï¼Œæ›´æ–°æ•°æ®åº“ã€‚</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#1f1f1f;">//è¾“å…¥ç•Œé¢

</span><span style="color:#1f1f1f;">View.NavigationPage
</span><span style="color:#1f1f1f;">    (icon = penImg, title = &quot;ç¬”è®°&quot;, toolbarItems = [ View.ToolbarItem(icon = saveImg, command = (fun()-&gt; dispatch Save) ) ], &lt;ç•¥&gt;)

</span><span style="color:#1f1f1f;">//update

</span><span style="color:#1f1f1f;">match msg with
</span><span style="color:#1f1f1f;">    | Save -&gt;
</span><span style="color:#1f1f1f;">        let newEntry =
</span><span style="color:#1f1f1f;">            { Content = model.NowWrite
</span><span style="color:#1f1f1f;">            Date = System.DateTime.Today
</span><span style="color:#1f1f1f;">            Id = model.NowId }

</span><span style="color:#1f1f1f;">        ELDb.upsert (newEntry) |&gt; ignore
</span><span style="color:#1f1f1f;">        { model with
</span><span style="color:#1f1f1f;">            NowWrite = &quot;&quot;
</span><span style="color:#1f1f1f;">            Data = ELDb.data.FindAll() },
</span><span style="color:#1f1f1f;">        Cmd.none
</span></code></pre></li>
</ol>
<h2 id="zui-hou-de-xiao-guo">æœ€åçš„æ•ˆæœ</h2>
<p><img src="./endless-21.jpg" alt="ç»“æœ" /></p>
<h2 id="qi-ta">å…¶ä»–</h2>
<ul>
<li>
<p>å®é™…å†™çš„æ—¶å€™å‘ç°è®¾è®¡æ²¡åšå¥½ï¼Œè¿˜éœ€è¦ä¸€ä¸ªâ€œæ–°å»ºâ€æŒ‰é’®å’Œâ€œåˆ é™¤â€æŒ‰é’®ã€‚æ–°å»ºçš„æ—¶å€™å°† ID ç½® 0ã€‚ï¼ˆåˆå›å»æ”¹ç¬¬ä¸€ç¯‡åšæ–‡ ğŸ˜“ï¼‰</p>
</li>
<li>
<p>å¼‚å¸¸å¤„ç†æ²¡åš</p>
</li>
<li>
<p>æ‰“åŒ…å‡ºæ¥ 20Mï¼Œä¸‹æ¬¡å†™ flutterã€‚</p>
</li>
</ul>
<p><strong>å‚è€ƒï¼š</strong></p>
<ul>
<li><a href="https://www.litedb.org/docs/">LiteDB æ–‡æ¡£å‚è€ƒ</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/xamarin/android/platform/files/#reading-or-writing-to-files-on-internal-storage">å†…éƒ¨å­˜å‚¨ä¸Šçš„æ–‡ä»¶è¯»å†™ - Xamarin</a></li>
</ul>

        </article>
        <div class="divider"></div>
        
            
                <div id="comment">
                    <div class="comment-placeholder"><i data-feather="loader"></i>åŠ è½½è¯„è®ºä¸­â€¦â€¦</div>
                    <script async crossorigin="anonymous" issue-term="pathname" repo="owlzou&#x2F;owlzou.github.io" src="https://utteranc.es/client.js" theme="github-light"></script>
                </div>
            
        
    </div>

          <div class="footer">
            <p>
              
                &copy;
                <a href="https:&#x2F;&#x2F;owlzou.github.io&#x2F;">Catalyst</a>
                2019-2021
              
            </p>
            <p>Powerd by
              <a href="https://www.getzola.org/">Zola</a>
              | Theme
              <a href="http://owlzou.github.io/posts/zola-theme-cafe/">Cafe</a>
            </p>
          </div>
        </div>
      </div>
    </div>
    
    
      <script src="https:&#x2F;&#x2F;owlzou.github.io&#x2F;script.js"></script>
      <script onload="feather.replace();" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <script onload="toc_onload()" src="https:&#x2F;&#x2F;owlzou.github.io&#x2F;tocbot.min.js"></script>

  </body>
</html>